"use strict";var O=exports&&exports.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,r)}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),g=exports&&exports.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),j=exports&&exports.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&O(e,n,t);return g(e,n),e},w=exports&&exports.__classPrivateFieldSet||function(n,e,t,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},s=exports&&exports.__classPrivateFieldGet||function(n,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},u,c,a;Object.defineProperty(exports,"__esModule",{value:!0});exports.isFunction=exports.Secret=void 0;var b=j(require("fs"));function y(n){return typeof n=="function"}exports.isFunction=y;var p=class n{constructor(e,t,i,...r){if(u.set(this,void 0),c.set(this,void 0),a.set(this,0),e===void 0&&t===void 0)throw new Error("Either `secret` or `func` must be specified");if(e!==void 0&&t!==void 0)throw new Error("Only `secret` or `func` should be specified, not both");if(t&&y(t)){let o=t(...r);if(o==null)throw new Error("Function to generate the secret returned undefined");w(this,u,o,"f")}else w(this,u,e,"f");if(i!==void 0){if(i<=0)throw new Error("`max_expose_count` when specified must be a positive integer");w(this,c,i,"f")}}toString(){return`Secret<${typeof s(this,u,"f")}>`}exposeSecret(){var e;if(!(s(this,c,"f")!==void 0&&s(this,a,"f")>=s(this,c,"f")))return w(this,a,(e=s(this,a,"f"),e++,e),"f"),s(this,u,"f")}get max_expose_count(){return s(this,c,"f")}get expose_count(){return s(this,a,"f")}static fromFile(e,t,i=void 0){console.log("Loading `targetKey` = ",t," from `filePath`",e);let o=b.readFileSync(e,"utf-8").split(`
`);for(let d of o){let[l,...f]=d.split("="),h=f.join("=").trim();if(!(!l||!h)&&l.trim()===t)return new n(h,void 0,i)}throw new Error(`\`${t}\` cannot be found!`)}static parseKeyValueFileIntoObjectOfKeySecret(e,t=void 0){let r=b.readFileSync(e,"utf-8").split(`
`),o={};for(let d of r){let l=d.trim();if(!l||l.startsWith("#"))continue;let[f,...h]=d.split("="),_=h.join("=").trim();if(!f||!_)continue;if(Object.keys(o).includes(f))throw new Error(`[ERROR]: Duplicated key \`${f}\` found`);let v=new n(_,void 0,function(){return t===void 0||typeof t=="number"?t:t[f]}());_!==void 0&&(o[f.trim()]=v)}return o}};exports.Secret=p;u=new WeakMap,c=new WeakMap,a=new WeakMap;
